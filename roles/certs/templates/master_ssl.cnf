[ req ]
req_extensions = v3_req
distinguished_name = req_distinguished_name
[req_distinguished_name]
[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth
subjectAltName = @alt_names
[ alt_names ]
DNS.1 = kubernetes
DNS.2 = kubernetes.default
DNS.3 = kubernetes.default.svc
DNS.4 = kubernetes.default.svc.cluster.local
DNS.5 = localhost
{% set ips = [] %}
{% set _ = ips.append('127.0.0.1') %}
{% set _ = ips.append(kube_service_cidr.split('.')[0] ~ '.' ~ kube_service_cidr.split('.')[1] ~ '.' ~ kube_service_cidr.split('.')[2] ~ '.1') %}
{% set _ = ips.append(kube_apiserver_vip) %}
{% for item in groups['kube_control_plane'] %}
{% set _ = ips.append(hostvars[item]['ip']) %}
{% endfor %}
{% if kube_network_dualstack_enabled | default(false) | bool %}
{% set _ = ips.append('::1') %}
{% set _ = ips.append(kube_apiserver_vip_ipv6) %}
{% for item in groups['kube_control_plane'] %}
{% set _ = ips.append(hostvars[item]['ipv6']) %}
{% endfor %}
{% endif %}
{% for ip in ips %}
IP.{{ loop.index }} = {{ ip }}
{% endfor %}
